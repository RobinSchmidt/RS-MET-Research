Draft - Under construction

The goal is to produce a pair of FIR filter kernels u[m] and d[m] where u is used for upsampling and
d for downsampling such that an upsample -> downsample roundtrip is an identity operation. The 
setting is as follows: We get an input signal x[n] and we want to oversample it by a factor M. We 
first produce a signal y[m] by zero stuffing the original input signal. We will have y[m=n*M] = x[n]
and for all other values m that are not a multiple of M, y[m] is zero. To this y signal, we apply 
the upsampling filter which we represent by its impulse respone u[m] to obtain z[m]. z[m] shall be 
smoothed version of y[m]. The filter u[m] serves as anti-imaging lowpass. Then, we apply to z[m] the
downsampling filter represented by its impulse response (aka kernel) d[m] to obtain w[m]. What we 
want is:

  w[n*M] = y[n*M]

such that when decimating w[m] to extract every M-th value, we get our original signal x[n] back 
exactly. For values of m that are not a multiple of M, we do not yet have any conditions. For the 
time being, these values can be whatever they want to be. We will later use these as degrees of 
freedom to optimize our filters u[m],d[m] to some criteria.





...TBC...


Let's denote r[m] the filter resulting from the convolution of u[m] and d[m]. For a 3rd order filter 
u and a 5th order filter d, we can express the convolution as the following matrix-vector equation:

  u0  0   0   0   0      d0     r0
  u1  u0  0   0   0      d1     r1  <--- = 0   Eq. 1
  u2  u1  u0  0   0   *  d2  =  r2
  0   u2  u1  u0  0      d3     r3  <--- = 1   Eq. 2
  0   0   u2  u1  u0     d4     r4
  0   0   0   u2  u1            r5  <--- = 0   Eq. 3
  0   0   0   0   u2            r6
							  
The perfect reconstruction conditions give us 3 equations from the marked 3 lines (verify!):

  u1*d0 + u0*d1                         = 0    Eq. 1
          u2*d1 + u1*d2 + u0*d3         = 1    Eq. 2
                          u2*d3 + u1*d4 = 0    Eq. 3

We have 5 unknowns d0,d1,d2,d3,d4 so to uniquely determine them, we need 2 more equations. Some 
possible additional conditions for d that could make sense are:

  Unit gain at DC:    d0 + d1 + d2 + d3 + d4 = 1   
  Zero gain at fs/2:  d0 - d1 + d2 - d3 + d4 = 0   (verify!)
  Odd symmetry:       d3 = d1   or   d3 - d1 = 0   
                      d4 = d0   or   d4 - d0 = 0   
  Even symmetry:      d3 = -d1  or   d3 + d1 = 0   
                      d4 = -d0  or   d4 + d0 = 0
  


Other ideas for conditions to satisfy:
-Symmetry around the midpoint like d3 = d1, d4 = d0? 
-Maybe we can also impose requirements of r such as: r1 + r2 + r3 + r4 + r5 + r6 = 1, etc.?
  
  
  
  
  
  
  
  
----------------------------------------------------------------------------------------------------  
Let's take the case where we impose symmetry on the downsampling kernel by construction by defining 
d = [d0 d1 d2 d1 d0], etc.. With this, the 5x5 system would look like this:

  u0  0   0   0   0      d0     r0
  u1  u0  0   0   0      d1     r1  <--- = 0   Eq. 1
  u2  u1  u0  0   0   *  d2  =  r2
  0   u2  u1  u0  0      d1     r3  <--- = 1   Eq. 2
  0   0   u2  u1  u0     d0     r4
  0   0   0   u2  u1            r5  <--- = 0   Eq. 3
  0   0   0   0   u2            r6

It's basically the general case from above with all occurrences of d3,d4 replaced by d1,d0 
respectively and occurrences of r4,r5,r6 replaced by r2,r1,r0 respectively. Let's extract the 
relevant equations again:

  1:  u1*d0 + u0*d1         = 0
  2:  u2*d1 + u1*d2 + u0*d1 = 1
  3:  u2*d1 + u1*d0         = 0

But wouldn't that mean that our 3 "lossless roundtrip" conditions already fix our 3 coeffs? But 
experience has shown that we do indeed have one free parameter to choose in this case. Maybe the 
first 3 equations are linearly dependent (and consistent)? Figure this out!




  
----------------------------------------------------------------------------------------------------  
Let's take the case with a symmetric upsampling kernel u = [u0 u1 u2 u1 u0] of length 5 as it would 
arise, for example, when linearly upsampling by a factor of M = 3 or upsampling via a cubic 
interpolator by a factor of M = 2 (verify!). I think, we may need a length 7 decimator (verify!)
d = [d0 d1 d2 d3 d2 d1 d0] and get a length 5+7-1 = 11 resulting filter 
r = [r0 r1 r2 r3 r4 r5 r4 r3 r2 r1 r0]. The matrix-vector equation looks like:

...TBC...


----------------------------------------------------------------------------------------------------
ToDo: 

- Derive formulas/algorithms to produce a downsampling kernel d for a given upsampling kernel u (or
  vice versa)

See also in RS-MET-Research/Prototypes/Cpp/Source/Main.cpp:

  testUpDownSample1D();
  testUpDownSample1D_2();
  
There are some implemetations of very small special cases of the general scheme that we want to 
derive here.



Resources:

https://www2.seas.gwu.edu/~ayoussef/papers/ImageDownUpSampling-CISST99.pdf