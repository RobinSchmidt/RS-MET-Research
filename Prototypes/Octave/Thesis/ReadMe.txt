Most of the code was originally written for matlab, so there may be 
compatibility issues - todo: fix them!